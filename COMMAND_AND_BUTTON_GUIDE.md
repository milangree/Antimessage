# 命令与按钮菜单对照表

## 概述
系统现在支持**两种使用方式**：
- ✅ **传统 `/` 命令** - 所有用户均可用
- ✅ **现代按钮菜单** - 仅管理员可用（通过 `/start` 打开）

### 权限说明

#### 👤 普通用户
- **可用功能**：发送消息、接收回复、人机验证
- **可用命令**：`/getid`、`/verification_mode`、`/disable_ai_check`、`/help` 等
- **按钮菜单**：❌ 不显示（简化体验，防止混淆）
- **快速方式**：直接使用 `/` 命令

#### 🔧 管理员用户  
- **可用功能**：所有普通用户功能 + 群组管理、黑名单管理等
- **可用命令**：所有命令，包括 `/panel`、`/blacklist`、`/stats` 等
- **按钮菜单**：✅ 完整显示（通过 `/start` 打开）
- **快速方式**：使用内联按钮菜单或 `/` 命令

### 新增功能

#### 🎯 默认验证模式
- **默认验证方式**：📝 **文本验证**（常识性问答）
- **如何切换**：在用户菜单中选择 🎯 验证模式，可切换为 🖼️ 图片验证或恢复默认设置
- **支持方式**：命令 `/verification_mode` 或内联按钮菜单（仅管理员）

#### 🔙 智能返回导航按钮
- **菜单导航**：管理员可在菜单间流畅切换
- **快速关闭**：普通用户可直接关闭菜单
- **简化流程**：避免复杂的菜单层级

## 用户功能对照

| 功能 | 命令方式 | 按钮菜单方式 |
|------|---------|------------|
| **获取用户ID** | `/getid` | `/start` → 📋 用户菜单 → ℹ️ 获取用户ID |
| **切换验证模式** | `/verification_mode` | `/start` → 📋 用户菜单 → 🎯 验证模式 |
| **AI 审查设置** | `/disable_ai_check` | `/start` → 📋 用户菜单 → 🤖 AI审查设置 |
| **RSS 订阅** | `/rss_add`, `/rss_list` | 暂无按钮，继续使用命令 |

### 用户菜单流程 - 管理员专用

```
/start 命令（管理员）
    ↓
显示主菜单（仅管理员看到按钮）
    ├── 📋 用户菜单
    │   ├── ℹ️ 获取用户ID
    │   │   └── ❌ 关闭 / 🔙 返回用户菜单（管理员）
    │   │
    │   ├── 🎯 验证模式（选择图片/文本/默认）
    │   │   ├── 🖼️ 图片验证码 → [设置成功] → ❌ 关闭 / 🔙 返回菜单（管理员）
    │   │   ├── 📝 文本验证 → [设置成功] → ❌ 关闭 / 🔙 返回菜单（管理员）
    │   │   ├── 🔄 使用默认设置 → [重置成功] → ❌ 关闭 / 🔙 返回菜单（管理员）
    │   │   └── 🔙 返回用户菜单
    │   │
    │   ├── 🤖 AI审查设置（启用/禁用）
    │   │   └── ❌ 关闭 / 🔙 返回用户菜单（管理员）
    │   │
    │   └── ❌ 关闭 / 🏠 返回主菜单（管理员）
    │
    └── 🔧 管理员菜单（仅管理员可见）
        ├── 📋 黑名单管理
        ├── 📊 统计信息
        ├── 🔒 豁免名单
        ├── ⚙️ 管理面板
        ├── 📝 自动回复
        ├── 🔍 被过滤消息
        ├── 🏠 返回主菜单
        └── ❌ 关闭


/start 命令（普通用户）
    ↓
显示欢迎信息和命令提示（无按钮菜单）
    └── 请使用命令：
        • /getid - 获取用户ID
        • /verification_mode - 切换验证模式
        • /disable_ai_check - 管理AI审查
        • /help - 显示帮助
```

## 管理员功能对照

| 功能 | 命令方式 | 按钮菜单方式 |
|------|---------|------------|
| **管理面板** | `/panel` | `/start` → 🔧 管理员菜单 → ⚙️ 管理面板 |
| **黑名单管理** | `/blacklist`, `/block`, `/unblock` | `/start` → 🔧 管理员菜单 → 📋 黑名单 |
| **统计信息** | `/stats` | `/start` → 🔧 管理员菜单 → 📊 统计信息 |
| **豁免名单** | `/exempt` | `/start` → 🔧 管理员菜单 → 🔒 豁免名单 |
| **自动回复** | `/autoreply` | `/start` → 🔧 管理员菜单 → 💬 自动回复 |
| **过滤消息** | `/view_filtered` | `/start` → 🔧 管理员菜单 → 🔍 被过滤消息 |

## 功能详细说明

### 验证模式设置

#### 📝 默认验证方式：文本验证
系统默认使用**文本验证**方式进行人机验证，具体包括：
- **问题类型**：常识性问答（如历史事件、科学知识等）
- **用户体验**：快速响应，适合大多数用户
- **无障碍性**：不依赖图片识别，对视觉障碍用户友好

#### 切换验证模式

**通过按钮菜单：**
1. 点击 `/start`
2. 选择 📋 用户菜单
3. 选择 🎯 验证模式
4. 选择您的偏好：
   - 🖼️ 图片验证码 - 数字图片验证
   - 📝 文本验证 - 常识性问答（**推荐**）
   - 🔄 使用默认设置 - 恢复系统默认

**通过命令：**
```
/verification_mode              - 打开验证模式菜单
/verification_mode text         - 切换为文本验证
/verification_mode image        - 切换为图片验证
/verification_mode default      - 恢复默认设置
```

### 菜单导航按钮（仅管理员可用）

#### 🏠 返回主菜单
- 从任何子菜单快速返回到主菜单
- 仅管理员菜单中显示
- 便捷地在管理和用户菜单间切换

#### 🔙 返回上级菜单
- 从详情页返回到上级菜单
- 仅管理员菜单中显示
- 清晰的菜单层级导航

#### ❌ 关闭菜单
- **管理员**：返回主菜单或关闭菜单
- **普通用户**：直接关闭菜单（回到聊天）
- 简单快捷的关闭方式

#### 💡 普通用户体验
- 普通用户不显示复杂的菜单按钮
- 通过 `/start` 命令获得简明的命令列表
- 推荐使用 `/` 命令获得更快的响应

## 使用建议

### 快速使用
**场景**: 需要快速完成操作
- 使用 `/` 命令更快
- 例如：`/getid` 直接显示信息

### 新用户友好
**场景**: 新用户不熟悉命令
- 使用按钮菜单更直观
- 通过 `/start` 进入，按钮引导

### 自动化集成
**场景**: 脚本或 bot 调用
- 继续使用 `/` 命令
- API 友好

### 人机界面
**场景**: 图形界面交互
- 推荐按钮菜单
- 更美观和易用

## 命令完整列表

### 用户命令
```
/start              - 启动并显示菜单
/help               - 显示帮助信息
/getid              - 获取你的用户ID
/disable_ai_check   - 管理 AI 内容审查设置
/verification_mode  - 切换验证模式（文本/图片/默认）
/rss_add <url>      - 添加 RSS 订阅
/rss_list           - 查看 RSS 订阅列表
/rss_remove <url|ID> - 移除 RSS 订阅
```

### 管理员命令
```
/panel              - 打开完整管理面板
/blacklist          - 查看黑名单
/block              - 在话题中拉黑用户
/unblock <user_id>  - 从黑名单移除用户
/stats              - 查看统计信息
/exempt <user_id> [options] - 豁免用户
/autoreply          - 管理自动回复功能
/view_filtered      - 查看被过滤的消息
```

## 新功能：JSON 消息分析

### 工作原理
- 系统自动检测 JSON 格式的消息
- 提取关键字段（message, quote_text 等）
- 通过 AI 分析判断是否为垃圾信息

### 示例
```python
# 用户发送此 JSON
{
  "message": "点击链接看视频",
  "reply_to": {
    "quote_text": "免费成人内容..."
  }
}

# 系统自动检测并分析
# AI 判定: is_spam = true
# 原因: "包含色情广告内容"
# 结果: 消息被拦截
```

### 支持的 JSON 字段
- `message` - 主消息文本
- `text` - 其他文本内容
- `reply_to.quote_text` - 被引用的文本
- `caption` - 媒体标题
- 其他任何包含文本的字段

## 菜单的优势

✅ **直观** - 按钮选项一目了然
✅ **易用** - 无需记住命令名称
✅ **交互** - 实时反馈和状态显示
✅ **引导** - 自动链接相关功能
✅ **兼容** - 与 `/` 命令完全兼容

## 命令的优势

✅ **快速** - 直接输入快速执行
✅ **脚本化** - 可用于自动化
✅ **历史** - 命令历史查看
✅ **批量** - 支持链式命令
✅ **传统** - 熟悉的交互方式

## 两者结合的优势

🎯 **最佳实践**
- 日常管理使用菜单（更直观）
- 频繁操作使用命令（更快速）
- 自动化脚本使用命令（更可靠）
- 新用户学习使用菜单（更友好）

## 常见问题

### 功能和命令相关

**Q: 是否必须使用按钮菜单？**
A: 不是。所有 `/` 命令对所有用户都完全可用。按钮菜单是管理员的便利功能。

**Q: 哪种方式更好？**
A: 这取决于个人习惯和使用场景。菜单更直观，命令更快速。

**Q: JSON 分析是自动的吗？**
A: 是的。系统会自动检测并分析 JSON 格式的消息。

**Q: 菜单会保存设置吗？**
A: 是的。所有设置（验证模式、AI检查等）都会保存到数据库。

### 权限和菜单相关

**Q: 为什么普通用户看不到按钮菜单？**
A: 为了简化用户体验。普通用户可以直接使用 `/` 命令获得更快的反应，无需浏览复杂菜单。

**Q: 普通用户可以使用哪些功能？**
A: 普通用户可以使用：
- `/getid` - 获取用户ID
- `/verification_mode` - 切换验证模式
- `/disable_ai_check` - 管理AI审查设置
- `/help` - 查看帮助信息

**Q: 我是管理员但看不到按钮菜单，怎么办？**
A: 请确认：
1. 你的用户ID是否在 `ADMIN_IDS` 配置中
2. 重启机器人后是否刷新了 `/start` 命令

**Q: 普通用户能否通过命令访问管理功能？**
A: 不能。所有管理命令都有权限检查，非管理员无法执行。

### 最佳实践

**Q: 管理员应该使用菜单还是命令？**
A: 推荐：
- **日常管理** - 使用按钮菜单（更直观，易于操作）
- **频繁操作** - 使用命令（更快速）
- **脚本自动化** - 使用命令（更可靠）
- **群组管理** - 优先使用 `/panel` 命令
